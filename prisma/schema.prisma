generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ────────────────────────────────────────────────
// Enums (combined & extended)
// ────────────────────────────────────────────────

enum VendorStatus {
  NEW
  UNDER_REVIEW
  APPROVED
  REJECTED
  BLACKLISTED
  NEEDS_RENEWAL
}

enum VendorDocumentType {
  COMMERCIAL_REGISTRATION
  ZAKAT_CERTIFICATE
  VAT_CERTIFICATE
  GOSI_CERTIFICATE
  ISO_CERTIFICATE
  SASO_SABER_CERTIFICATE
  HSE_PLAN
  WARRANTY_CERTIFICATE
  QUALITY_PLAN
  ORGANIZATION_CHART
  TECHNICAL_FILE
  FINANCIAL_FILE
  BANK_LETTER
  INSURANCE_CERTIFICATE
  INDUSTRY_LICENSE
  VENDOR_CODE_OF_CONDUCT
  COMPANY_PROFILE
  // You can add COMPANY_LOGO here later if you prefer logo as document
}

enum SignatureRequestStatus {
  PENDING
  SIGNED
  EXPIRED
  CANCELLED
}

enum TaskType {
  VENDOR_REVIEW
  RFQ_EVALUATION
  CONTRACT_REVIEW
  IPC_PROCESSING
  DOCUMENT_VERIFICATION
  PROJECT_FOLLOWUP
  GENERAL
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  OVERDUE
  CANCELLED
}

enum ReportCategory {
  FINANCIAL
  VENDOR
  CONTRACT
  PROJECT
  CUSTOM
}

enum ReportFrequency {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
}

enum FilterType {
  DATE
  SELECT
  MULTISELECT
  NUMBER
  TEXT
  BOOLEAN
}

enum DataType {
  STRING
  NUMBER
  DATE
  CURRENCY
  PERCENTAGE
  BOOLEAN
}

enum AggregationType {
  SUM
  AVERAGE
  COUNT
  MIN
  MAX
  NONE
}

enum ReportStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum ExecutionStatus {
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum UserStatus {
  PENDING
  ACTIVE
}

enum RoleName {
  ADMIN
  PROCUREMENT_MANAGER
  PROCUREMENT_ENGINEER
  COST_MANAGER
  PROJECT_MANAGER
  TECHNICAL_OFFICE
  DATA_CONTROLLER
  VENDOR_USER
}

enum RFQStatus {
  DRAFT
  ISSUED
  OPEN
  CLOSED
  AWARDED
  CANCELED
}

enum IPCStatus {
  SUBMITTED
  PROCUREMENT_REVIEW
  TECHNICAL_APPROVED
  FINANCE_REVIEW
  APPROVED
  PAID
  REJECTED
}

enum SignatureStatus {
  NOT_REQUIRED
  PENDING_SIGNATURE
  SIGNED
  REJECTED
  EXPIRED
}

enum DocumentApprovalStatus {
  DRAFT
  PENDING_APPROVAL
  IN_REVIEW
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

enum RequestStatus {
  PENDING
  SUBMITTED
  APPROVED
  REJECTED
  OVERDUE
  CANCELLED
}

enum ApprovalInstanceStatus {
  PENDING
  IN_PROGRESS
  APPROVED
  REJECTED
  CANCELLED
  ESCALATED
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  RETURNED
  ESCALATED
}

// ────────────────────────────────────────────────
// Models
// ────────────────────────────────────────────────

model User {
  id                            Int                           @id @default(autoincrement())
  uuid                          String                        @unique @default(uuid())
  name                          String?
  email                         String                        @unique
  password                      String
  roleId                        Int
  isActive                      Boolean                       @default(true)
  createdAt                     DateTime                      @default(now())
  updatedAt                     DateTime                      @updatedAt
  accessCode                    String?
  status                        String                        @default("ACTIVE")
  department                    String?
  employeeId                    String?                       @unique
  jobTitle                      String?
  lastLoginDate                 DateTime?

  approvals                     Approval[]                    @relation("UserApprovals")
  requestedApprovals            Approval[]                    @relation("UserRequestedApprovals")
  approvalSteps                 ApprovalStep[]                @relation("ApprovalStepApprover")
  createdApprovalWorkflows      ApprovalWorkflow[]            @relation("ApprovalWorkflowCreator")
  auditLogs                     AuditLog[]                    @relation("UserAuditLogs")
  documentApprovals             DocumentApproval[]            @relation("DocumentApprovalApprover")
  createdTemplates              DocumentTemplate[]            @relation("DocumentTemplateCreator")
  evaluations                   Evaluation[]                  @relation("UserEvaluations")
  ipcs                          IPC[]                         @relation("UserIPCs")
  rfqs                          RFQ[]                         @relation("UserRFQs")
  reportsCreated                Report[]                      @relation("UserCreatedReports")
  reportExecutions              ReportExecution[]             @relation("UserReportExecutions")
  tasksCreated                  Task[]                        @relation("CreatedTasks")
  tasksAssigned                 Task[]                        @relation("AssignedTasks")
  role                          Role                          @relation(fields: [roleId], references: [id])
  reportFavorites               UserReportFavorite[]          @relation("UserReportFavorites")
  vendorsAssigned               Vendor[]                      @relation("AssignedReviewer")
  vendorsReviewed               Vendor[]                      @relation("LastReviewedBy")
  vendor                        Vendor?
  approvalActions               ApprovalAction[]              @relation("ApprovalActionApprover")
  signedDocuments               Document[]                    @relation("SignedDocuments")
  documents                     Document[]                    @relation("uploadedBy")
  informationRequestsCreated    InformationRequest[]
  notifications                 Notification[]                @relation("UserNotifications")
  signatureRequestsCreated      SignatureRequest[]            @relation("SignatureRequestRequester")
  signatureRequestsSigned       SignatureRequest[]            @relation("SignatureRequestSigner")
}

model Role {
  id                        Int                         @id @default(autoincrement())
  desc                      String?
  name                      String                      @unique
  users                     User[]
  documentApprovalSteps     DocumentApprovalStep[]
  approvalWorkflowSteps     ApprovalWorkflowStep[]
}

model Vendor {
  id                        Int                         @id @default(autoincrement())
  vendorId                  String?                     @unique
  companyLegalName          String?
  code                      String?                     @unique
  vendorType                String
  ownershipType             String?
  businessType              String?
  licenseNumber             String?
  yearsInBusiness           Int?
  gosiEmployeeCount         Int?
  chamberClass              String?
  chamberRegion             String?
  chamberExpiryDate         DateTime?
  vatNumber                 String?
  productsAndServices       String[]
  crNumber                  String?                     @unique
  contactPerson             String?
  contactPhone              String?
  contactEmail              String?
  website                   String?
  addressStreet             String?
  addressCity               String?
  addressRegion             String?
  addressCountry            String?
  primaryContactName        String?
  primaryContactTitle       String?
  technicalContactName      String?
  technicalContactEmail     String?
  financialContactName      String?
  financialContactEmail     String?
  status                    VendorStatus                @default(NEW)
  kreStatus                 String                      @default("New")
  reviewNotes               String?
  reviewStatus              String?
  vendorClass               String?                     @default("D")
  qualificationScore        Float?                      @default(0)
  isQualified               Boolean                     @default(false)
  assignedReviewerId        Int?
  lastReviewedById          Int?
  lastReviewedAt            DateTime?                   @db.Timestamptz
  nextReviewDate            DateTime?
  userId                    Int                         @unique
  logo                      String?                     // ← re-added from localhost
  csiSpecialization         String?                     // ← kept (was in localhost)
  mainCategory              String[]                    // ← kept if still used, but consider migrating to relation
  subCategory               String?

  user                      User                        @relation(fields: [userId], references: [id])
  projectExperience         VendorProjectExperience[]
  documents                 VendorDocument[]
  categories                VendorToCategory[]          @relation("VendorToCategory")
  assignedReviewer          User?                       @relation("AssignedReviewer", fields: [assignedReviewerId], references: [id])
  lastReviewedBy            User?                       @relation("LastReviewedBy", fields: [lastReviewedById], references: [id])
  defaultCsiMaterial        CSI_Material[]              @relation("CSI_MaterialToVendor")
  priceEntries              PriceEntry[]
  submissions               RFQSubmission[]
  contracts                 Contract[]
  informationRequests       InformationRequest[]

  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
}

model VendorDocument {
  id              Int                 @id @default(autoincrement())
  vendorId        Int
  docType         VendorDocumentType
  url             String
  fileName        String
  expiryDate      DateTime?
  documentNumber  String?
  vatNumber       String?
  gosiNumber      String?
  isoType         String?
  isValid         Boolean             @default(true)
  uploadedAt      DateTime            @default(now())

  vendor          Vendor              @relation(fields: [vendorId], references: [id])
}

model VendorProjectExperience {
  id              Int     @id @default(autoincrement())
  vendorId        Int
  projectName     String
  clientName      String
  contractValue   Float
  startDate       DateTime?
  endDate         DateTime?
  scopeDescription String?
  referenceContact String?
  completionFile  String?

  vendor          Vendor  @relation(fields: [vendorId], references: [id])
}

model Category {
  id          Int                 @id @default(autoincrement())
  name        String              @unique
  csiCode     String?             @unique
  description String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt

  vendors     VendorToCategory[]
}

model VendorToCategory {
  id          Int     @id @default(autoincrement())
  vendorId    Int
  categoryId  Int

  vendor      Vendor  @relation("VendorToCategory", fields: [vendorId], references: [id])
  category    Category @relation(fields: [categoryId], references: [id])

  @@unique([vendorId, categoryId])
}


model CSI_Material {
  id              Int          @id @default(autoincrement())
  csiCode         String?
  name            String
  unit            String?
  defaultVendorId Int?
  defaultVendor   Vendor?      @relation("CSI_MaterialToVendor", fields: [defaultVendorId], references: [id])
  priceEntries    PriceEntry[]
}

model PriceEntry {
  id            Int          @id @default(autoincrement())
  materialId    Int
  vendorId      Int
  unitPrice     Float
  currency      String       @default("NGN")
  createdAt     DateTime     @default(now())
  effectiveDate DateTime     @default(now())
  expiryDate    DateTime?
  updatedAt     DateTime     @updatedAt
  material      CSI_Material @relation(fields: [materialId], references: [id])
  vendor        Vendor       @relation(fields: [vendorId], references: [id])
}

model RFQ {
  id                   Int                  @id @default(autoincrement())
  rfqNumber            String               @unique
  projectName          String
  packageScope         String?
  itemDesc             String?
  csiCode              String?
  estimatedUnitPrice   Float?
  requiredDate         DateTime?
  targetSubmissionDate DateTime?
  currency             String               @default("SAR")
  createdById          Int
  status               RFQStatus            @default(DRAFT)
  createdAt            DateTime             @default(now())
  description          String?
  dueDate              DateTime?
  title                String
  updatedAt            DateTime             @updatedAt
  contracts            Contract[]           @relation("RFQContract")
  createdBy            User                 @relation("UserRFQs", fields: [createdById], references: [id])
  submissions          RFQSubmission[]
  rfqAttachments       rfqAttachments[]
  informationRequests  InformationRequest[]
}

model RFQSubmission {
  id          Int          @id @default(autoincrement())
  rfqId       Int
  vendorId    Int
  submittedAt DateTime?    @default(now())
  totalValue  Float?
  currency    String       @default("SAR")
  docUrl      String?
  items       Json?
  status      String?
  totalAmount Float?
  evaluations Evaluation[]
  rfq         RFQ          @relation(fields: [rfqId], references: [id])
  vendor      Vendor       @relation(fields: [vendorId], references: [id])
}

model Evaluation {
  id              Int           @id @default(autoincrement())
  submissionId    Int
  evaluatorId     Int
  technicalScore  Float?
  financialScore  Float?
  experienceScore Float?
  responsiveness  Float?
  otherScore      Float?
  totalScore      Float?
  comments        String?
  createdAt       DateTime      @default(now())
  evaluator       User          @relation("UserEvaluations", fields: [evaluatorId], references: [id])
  submission      RFQSubmission @relation(fields: [submissionId], references: [id])
}

model Contract {
  id              Int              @id @default(autoincrement())
  contractNumber  String           @unique
  rfqId           Int?
  vendorId        Int
  contractValue   Float
  currency        String           @default("SAR")
  startDate       DateTime?
  endDate         DateTime?
  status          String?
  createdAt       DateTime         @default(now())
  rfq             RFQ?             @relation("RFQContract", fields: [rfqId], references: [id])
  vendor          Vendor           @relation(fields: [vendorId], references: [id])
  ipcs            IPC[]
  variationOrders VariationOrder[]
  documents       Document[]       @relation("ContractDocuments")
}

model VariationOrder {
  id          Int      @id @default(autoincrement())
  voRef       String   @unique
  contractId  Int
  description String?
  costImpact  Float?
  timeImpact  Int?
  status      String?
  createdAt   DateTime @default(now())
  contract    Contract @relation(fields: [contractId], references: [id])
}

model IPC {
  id              Int        @id @default(autoincrement())
  ipcNumber       String     @unique
  projectName     String?
  contractId      Int
  periodFrom      DateTime?
  periodTo        DateTime?
  currentValue    Float
  cumulativeValue Float?
  deductions      Float?
  netPayable      Float?
  status          IPCStatus  @default(SUBMITTED)
  submittedById   Int
  createdAt       DateTime   @default(now())
  contract        Contract   @relation(fields: [contractId], references: [id])
  submittedBy     User       @relation("UserIPCs", fields: [submittedById], references: [id])
  attachments     Document[] @relation("IPCAttachments")
}

model InformationRequest {
  id                Int           @id @default(autoincrement())
  uuid              String        @unique @default(uuid())
  title             String
  description       String?
  requestType       String
  status            RequestStatus @default(PENDING)
  priority          Priority      @default(MEDIUM)
  vendorId          Int
  createdById       Int
  createdByName     String?
  dueDate           DateTime
  responseDate      DateTime?
  responseText      String?
  rejectionReason   String?
  approvedDate      DateTime?
  documentId        Int?
  rfqId             Int?
  timeline          Json?
  notificationCount Int           @default(0)
  lastNotified      DateTime?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  createdBy         User          @relation(fields: [createdById], references: [id])
  document          Document?     @relation("RequestLinkedDocument", fields: [documentId], references: [id])
  rfq               RFQ?          @relation(fields: [rfqId], references: [id])
  vendor            Vendor        @relation(fields: [vendorId], references: [id])
  attachments       Document[]    @relation("InformationRequestAttachments")
  responseFiles     Document[]    @relation("InformationRequestResponseFiles")

  @@index([vendorId, status])
  @@index([dueDate])
  @@index([createdById])
  @@map("information_requests")
}

model Document {
  id                            Int                       @id @default(autoincrement())
  fileName                      String
  fileUrl                       String
  url                           String
  mimeType                      String?
  size                          Int?
  uploadedById                  Int?
  uploadedAt                    DateTime                  @default(now())
  version                       Int                       @default(1)
  isCurrent                     Boolean                   @default(true)
  previousVersionId             Int?
  requiresSignature             Boolean                   @default(false)
  signatureStatus               SignatureStatus           @default(NOT_REQUIRED)
  signedById                    Int?
  signedAt                      DateTime?
  approvalStatus                DocumentApprovalStatus    @default(DRAFT)
  approvalWorkflowId            Int?
  ipcId                         Int?
  contractId                    Int?
  tags                          String[]
  category                      String?
  description                   String?
  documentApprovals             DocumentApproval[]        @relation("DocumentApprovals")
  rfqAttachments                rfqAttachments[]
  approvalWorkflow              DocumentApprovalWorkflow? @relation(fields: [approvalWorkflowId], references: [id])
  contract                      Contract?                 @relation("ContractDocuments", fields: [contractId], references: [id])
  ipc                           IPC?                      @relation("IPCAttachments", fields: [ipcId], references: [id])
  previousVersion               Document?                 @relation("DocumentVersions", fields: [previousVersionId], references: [id])
  nextVersions                  Document[]                @relation("DocumentVersions")
  signedBy                      User?                     @relation("SignedDocuments", fields: [signedById], references: [id])
  uploadedBy                    User?                     @relation("uploadedBy", fields: [uploadedById], references: [id])
  linkedInformationRequests     InformationRequest[]      @relation("RequestLinkedDocument")
  signatureRequests             SignatureRequest[]        @relation("DocumentSignatureRequests")
  informationRequestAttachments InformationRequest[]      @relation("InformationRequestAttachments")
  informationRequestResponses   InformationRequest[]      @relation("InformationRequestResponseFiles")

  @@map("documents")
}

model DocumentApprovalWorkflow {
  id          Int                    @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime               @default(now())
  isActive    Boolean                @default(true)
  steps       DocumentApprovalStep[]
  documents   Document[]
}

model DocumentApprovalStep {
  id                Int                      @id @default(autoincrement())
  workflowId        Int
  sequence          Int
  roleId            Int
  isRequired        Boolean                  @default(true)
  documentApprovals DocumentApproval[]       @relation("DocumentApprovalSteps")
  role              Role                     @relation(fields: [roleId], references: [id])
  workflow          DocumentApprovalWorkflow @relation(fields: [workflowId], references: [id])

  @@unique([workflowId, sequence])
}

model DocumentApproval {
  id         Int                  @id @default(autoincrement())
  documentId Int
  stepId     Int
  approverId Int
  status     ApprovalStatus       @default(PENDING)
  comments   String?
  approvedAt DateTime?
  createdAt  DateTime             @default(now())
  approver   User                 @relation("DocumentApprovalApprover", fields: [approverId], references: [id])
  document   Document             @relation("DocumentApprovals", fields: [documentId], references: [id])
  step       DocumentApprovalStep @relation("DocumentApprovalSteps", fields: [stepId], references: [id])

  @@unique([documentId, stepId])
}

model DocumentTemplate {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  category    String
  fileUrl     String?
  content     Json?
  variables   Json?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  createdById Int
  createdBy   User     @relation("DocumentTemplateCreator", fields: [createdById], references: [id])
}

model Approval {
  id                String            @id @default(cuid())
  entityType        String
  entityId          String
  approverId        Int?
  sequence          Int?
  status            ApprovalStatus    @default(PENDING)
  createdAt         DateTime          @default(now())
  currentStep       Int               @default(0)
  escalationLevel   Int?
  parallelApprovals Boolean           @default(false)
  slaBreached       Boolean           @default(false)
  slaDeadline       DateTime?
  stepRequirements  Json?
  totalSteps        Int               @default(1)
  workflowId        String?
  comments          String?
  requestedById     Int
  updatedAt         DateTime          @updatedAt
  approver          User?             @relation("UserApprovals", fields: [approverId], references: [id])
  requestedBy       User              @relation("UserRequestedApprovals", fields: [requestedById], references: [id])
  workflow          ApprovalWorkflow? @relation(fields: [workflowId], references: [id])
  steps             ApprovalStep[]

  @@index([entityType, entityId])
  @@index([status])
  @@index([requestedById])
  @@map("Approval")
}

model ApprovalWorkflow {
  id          String     @id @default(cuid())
  name        String     @db.VarChar(255)
  description String?
  entityType  String     @db.VarChar(50)
  conditions  Json?
  steps       Json
  isActive    Boolean    @default(true)
  createdById Int
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  approvals   Approval[]
  createdBy   User       @relation("ApprovalWorkflowCreator", fields: [createdById], references: [id])

  @@map("ApprovalWorkflow")
}

model ApprovalStep {
  id           String         @id @default(cuid())
  approvalId   String
  stepNumber   Int
  stepName     String         @db.VarChar(255)
  approverRole Int
  approverId   Int?
  status       ApprovalStatus @default(PENDING)
  comments     String?
  approvedAt   DateTime?
  escalatedAt  DateTime?
  slaDeadline  DateTime?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  approval     Approval       @relation(fields: [approvalId], references: [id], onDelete: Cascade)
  approver     User?          @relation("ApprovalStepApprover", fields: [approverId], references: [id])

  @@index([approvalId])
  @@index([approverId])
  @@index([status])
  @@map("ApprovalStep")
}

model ApprovalWorkflowTemplate {
  id                String                 @id @default(uuid())
  name              String
  description       String?
  category          String
  isActive          Boolean                @default(true)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  approvalInstances ApprovalInstance[]     @relation("ApprovalWorkflowInstances")
  steps             ApprovalWorkflowStep[]

  @@map("approval_workflow_templates")
}

model ApprovalWorkflowStep {
  id              String                   @id @default(uuid())
  templateId      String
  sequence        Int
  roleId          Int
  isRequired      Boolean                  @default(true)
  minAmount       Float?
  maxAmount       Float?
  conditions      Json?
  approvalActions ApprovalAction[]         @relation("ApprovalWorkflowStepActions")
  role            Role                     @relation(fields: [roleId], references: [id])
  template        ApprovalWorkflowTemplate @relation(fields: [templateId], references: [id])

  @@unique([templateId, sequence])
  @@map("approval_workflow_steps")
}

model ApprovalInstance {
  id          String                   @id @default(uuid())
  entityType  String
  entityId    Int
  workflowId  String
  status      ApprovalInstanceStatus   @default(PENDING)
  currentStep Int                      @default(0)
  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  approvals   ApprovalAction[]
  workflow    ApprovalWorkflowTemplate @relation("ApprovalWorkflowInstances", fields: [workflowId], references: [id])

  @@unique([entityType, entityId])
  @@map("approval_instances")
}

model ApprovalAction {
  id                String               @id @default(uuid())
  instanceId        String
  stepId            String
  approverId        Int
  status            ApprovalStatus       @default(PENDING)
  comments          String?
  signedAt          DateTime?
  signatureData     Json?
  metadata          Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  approver          User                 @relation("ApprovalActionApprover", fields: [approverId], references: [id])
  instance          ApprovalInstance     @relation(fields: [instanceId], references: [id])
  step              ApprovalWorkflowStep @relation("ApprovalWorkflowStepActions", fields: [stepId], references: [id])
  signatureRequests SignatureRequest[]   @relation("ApprovalActionSignatureRequests")

  @@unique([instanceId, stepId])
  @@map("approval_actions")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int?
  action    String
  entity    String?
  entityId  Int?
  data      Json?
  createdAt DateTime @default(now())
  user      User?    @relation("UserAuditLogs", fields: [userId], references: [id])
}

model Notification {
  id        Int       @id @default(autoincrement())
  userId    Int
  title     String
  body      String?
  type      String    @default("INFO")
  priority  String    @default("MEDIUM")
  read      Boolean   @default(false)
  readAt    DateTime?
  actionUrl String?
  metadata  Json?
  createdAt DateTime  @default(now())
  user      User      @relation("UserNotifications", fields: [userId], references: [id])

  @@map("notifications")
}

model Report {
  id                Int                  @id @default(autoincrement())
  name              String
  description       String?
  category          String
  dataSource        String
  createdById       Int
  isPublic          Boolean              @default(false)
  isScheduled       Boolean              @default(false)
  scheduleFrequency String?
  nextSchedule      DateTime?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime             @updatedAt
  createdBy         User                 @relation("UserCreatedReports", fields: [createdById], references: [id])
  columns           ReportColumn[]
  executions        ReportExecution[]
  filters           ReportFilter[]
  favorites         UserReportFavorite[]
}

model ReportFilter {
  id        Int    @id @default(autoincrement())
  reportId  Int
  field     String
  operator  String
  value     String
  sortOrder Int    @default(0)
  report    Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model ReportColumn {
  id              Int    @id @default(autoincrement())
  reportId        Int
  fieldName       String
  columnLabel     String
  dataType        String
  aggregationType String @default("NONE")
  sortOrder       Int    @default(0)
  report          Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model ReportExecution {
  id            Int      @id @default(autoincrement())
  reportId      Int
  executedById  Int
  status        String
  parameters    Json?
  recordCount   Int?
  executionTime Int?
  errorMessage  String?
  filePath      String?
  executedAt    DateTime @default(now())
  executedBy    User     @relation("UserReportExecutions", fields: [executedById], references: [id])
  report        Report   @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model UserReportFavorite {
  id       Int    @id @default(autoincrement())
  userId   Int
  reportId Int
  report   Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user     User   @relation("UserReportFavorites", fields: [userId], references: [id])

  @@unique([userId, reportId])
}

model ReportTemplate {
  id          String         @id @default(uuid())
  name        String
  description String?
  category    ReportCategory
  dataSource  String
  template    Json
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())

  @@map("report_templates")
}

model Task {
  id             Int        @id @default(autoincrement())
  title          String
  description    String?
  taskType       TaskType
  assignedTo     Int
  assignedById   Int
  dueDate        DateTime
  priority       Priority   @default(MEDIUM)
  status         TaskStatus @default(NOT_STARTED)
  remarks        String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  assignedByUser User       @relation("CreatedTasks", fields: [assignedById], references: [id])
  assignedUser   User       @relation("AssignedTasks", fields: [assignedTo], references: [id])
}

model SignatureRequest {
  id               String                 @id @default(uuid())
  approvalActionId String
  documentId       Int
  requesterId      Int
  signerId         Int?
  status           SignatureRequestStatus @default(PENDING)
  signatureData    Json?
  ipAddress        String?
  expiresAt        DateTime
  signedAt         DateTime?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  approvalAction   ApprovalAction         @relation("ApprovalActionSignatureRequests", fields: [approvalActionId], references: [id], onDelete: Cascade)
  document         Document               @relation("DocumentSignatureRequests", fields: [documentId], references: [id])
  requester        User                   @relation("SignatureRequestRequester", fields: [requesterId], references: [id])
  signer           User?                  @relation("SignatureRequestSigner", fields: [signerId], references: [id])

  @@unique([approvalActionId, documentId])
  @@map("signature_requests")
}

model rfqAttachments {
  A         Int
  B         Int
  documents Document @relation(fields: [A], references: [id], onDelete: Cascade)
  RFQ       RFQ      @relation(fields: [B], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_rfqAttachments_AB_unique")
  @@index([B], map: "_rfqAttachments_B_index")
  @@map("_rfqAttachments")
}
